{% extends 'base.html' %}

{% block content %}
<div class="form-container">
    <h2>Admin Dashboard</h2>
    <p>Welcome Admin. Manage your content here.</p>

    <hr>

    <h3>Upload/Update Content for Projects</h3>

    <form method="POST" action="{{ url_for('main_routes.upload_file') }}" enctype="multipart/form-data" class="needs-validation" novalidate>
        <div class="mb-3">
            <label for="projectItemName" class="form-label">Project Name (for existing project or new project title):</label>
            <input type="text" class="form-control" id="projectItemName" name="item_name" required>
            <div class="invalid-feedback">Please provide a project name.</div>
        </div>

        <div class="mb-3">
            <label for="projectFileType" class="form-label">Select Content Type:</label>
            <select class="form-select" id="projectFileType" name="file_type" required onchange="toggleProjectFileInputs()">
                <option value="">--Select Type--</option>
                <option value="image">Image (png/jpg/jpeg/gif)</option>
                <option value="video">Video (mp4)</option>
                <option value="circuitdiagram">Circuit Diagram (png/jpg/jpeg)</option>
                <option value="description">Description (Text)</option>
                <option value="code">Code (Text)</option>
                <option value="connections">Connections (Text)</option>
                <option value="procedure">Procedure (Text)</option>
            </select>
            <div class="invalid-feedback">Please select a content type.</div>
        </div>

        <div id="projectFileUploadSection" class="mb-3" style="display: none;">
            <label for="projectFile" class="form-label">Select File:</label>
            <input type="file" class="form-control" id="projectFile" name="file" accept="image/*,video/*,.pdf,.py,.c,.ino,.txt,.zip,.rar">
            <div class="invalid-feedback">Please select a file for upload.</div>
        </div>

        <div id="projectTextContentSection" class="mb-3" style="display: none;">
            <label for="projectTextContent" class="form-label">Enter Content:</label>
            <textarea class="form-control" id="projectTextContent" name="text_content" rows="10"></textarea>
            <div class="invalid-feedback">Please enter text content.</div>
        </div>

        <input type="hidden" name="category" value="projects">
        <button type="submit" class="btn btn-primary">Upload/Save to Projects</button>
    </form>

    <hr>

    <h3>Upload/Update Content for Testing</h3>

    <form method="POST" action="{{ url_for('main_routes.upload_file') }}" enctype="multipart/form-data" class="needs-validation" novalidate>
        <div class="mb-3">
            <label for="testingItemName" class="form-label">Testing Name (for existing testing item or new testing title):</label>
            <input type="text" class="form-control" id="testingItemName" name="item_name" required>
            <div class="invalid-feedback">Please provide a testing item name.</div>
        </div>

        <div class="mb-3">
            <label for="testingFileType" class="form-label">Select Content Type:</label>
            <select class="form-select" id="testingFileType" name="file_type" required onchange="toggleTestingFileInputs()">
                <option value="">--Select Type--</option>
                <option value="image">Image (png/jpg/jpeg/gif)</option>
                <option value="video">Video (mp4)</option>
                <option value="circuitdiagram">Circuit Diagram (png/jpg/jpeg)</option>
                <option value="description">Description (Text)</option>
                <option value="code">Code (Text)</option>
                <option value="connections">Connections (Text)</option>
                <option value="procedure">Procedure (Text)</option>
            </select>
            <div class="invalid-feedback">Please select a content type.</div>
        </div>

        <div id="testingFileUploadSection" class="mb-3" style="display: none;">
            <label for="testingFile" class="form-label">Select File:</label>
            <input type="file" class="form-control" id="testingFile" name="file" accept="image/*,video/*,.pdf,.py,.c,.ino,.txt,.zip,.rar">
            <div class="invalid-feedback">Please select a file for upload.</div>
        </div>

        <div id="testingTextContentSection" class="mb-3" style="display: none;">
            <label for="testingTextContent" class="form-label">Enter Content:</label>
            <textarea class="form-control" id="testingTextContent" name="text_content" rows="10"></textarea>
            <div class="invalid-feedback">Please enter text content.</div>
        </div>

        <input type="hidden" name="category" value="testing">
        <button type="submit" class="btn btn-primary">Upload/Save to Testing</button>
    </form>

    <hr>

    <h3>Existing Projects</h3>
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Title</th>
                <th>Slug</th>
                <th>Created At</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for project in projects %}
            <tr>
                <td>{{ project.title }}</td>
                <td>{{ project.slug }}</td>
                <td>{{ project.created_at|format_date }}</td>
                <td>
                    <a href="{{ url_for('main_routes.project_detail', slug=project.slug) }}" class="btn btn-info btn-sm">View</a>
                    <form action="{{ url_for('main_routes.delete_item', category='projects', item_id=project.id) }}" method="POST" class="d-inline confirm-delete">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4">No projects found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <hr>

    <h3>Existing Testing Items</h3>
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Title</th>
                <th>Slug</th>
                <th>Created At</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in testings %}
            <tr>
                <td>{{ item.title }}</td>
                <td>{{ item.slug }}</td>
                <td>{{ item.created_at|format_date }}</td>
                <td>
                    <a href="{{ url_for('main_routes.testing_detail', slug=item.slug) }}" class="btn btn-info btn-sm">View</a>
                    <form action="{{ url_for('main_routes.delete_item', category='testing', item_id=item.id) }}" method="POST" class="d-inline confirm-delete">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4">No testing items found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    function toggleProjectFileInputs() {
        const fileType = document.getElementById('projectFileType').value;
        const fileUploadSection = document.getElementById('projectFileUploadSection');
        const textContentSection = document.getElementById('projectTextContentSection');
        const fileInput = document.getElementById('projectFile');
        const textInput = document.getElementById('projectTextContent');

        if (['image', 'video', 'circuitdiagram'].includes(fileType)) {
            fileUploadSection.style.display = 'block';
            fileInput.setAttribute('required', 'required');
            textContentSection.style.display = 'none';
            textInput.removeAttribute('required');
            textInput.value = ''; // Clear text content
        } else if (['description', 'code', 'connections', 'procedure'].includes(fileType)) {
            fileUploadSection.style.display = 'none';
            fileInput.removeAttribute('required');
            fileInput.value = ''; // Clear file input
            textContentSection.style.display = 'block';
            textInput.setAttribute('required', 'required');
        } else {
            fileUploadSection.style.display = 'none';
            fileInput.removeAttribute('required');
            fileInput.value = '';
            textContentSection.style.display = 'none';
            textInput.removeAttribute('required');
            textInput.value = '';
        }
    }

    function toggleTestingFileInputs() {
        const fileType = document.getElementById('testingFileType').value;
        const fileUploadSection = document.getElementById('testingFileUploadSection');
        const textContentSection = document.getElementById('testingTextContentSection');
        const fileInput = document.getElementById('testingFile');
        const textInput = document.getElementById('testingTextContent');

        if (['image', 'video', 'circuitdiagram'].includes(fileType)) {
            fileUploadSection.style.display = 'block';
            fileInput.setAttribute('required', 'required');
            textContentSection.style.display = 'none';
            textInput.removeAttribute('required');
            textInput.value = '';
        } else if (['description', 'code', 'connections', 'procedure'].includes(fileType)) {
            fileUploadSection.style.display = 'none';
            fileInput.removeAttribute('required');
            fileInput.value = '';
            textContentSection.style.display = 'block';
            textInput.setAttribute('required', 'required');
        } else {
            fileUploadSection.style.display = 'none';
            fileInput.removeAttribute('required');
            fileInput.value = '';
            textContentSection.style.display = 'none';
            textInput.removeAttribute('required');
            textInput.value = '';
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
        toggleProjectFileInputs();
        toggleTestingFileInputs();
    });
</script>
{% endblock %}
